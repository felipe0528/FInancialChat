@{
    ViewBag.Title = "Home Page";
    var users = ViewBag.Users;
}
    <br />
<p>Select recipient:</p>

@Html.DropDownList("recipient", new SelectList(ViewBag.Users, "Select Recipient"), new { @class = "form-control" })
<br />
<p>Message:</p>
<div class="form-group">
    <input type="text" name="txtmsg" id="txtmsg" class="form-control" />
</div>
<div class="form-group">
    <input type="button" value="send" class="btn btn-success" name="btnsend" id="btnsend" />
</div>
<br />
<div class="col-md-12">
    <div class="panel panel-success">
        <div class="panel-heading">
            <div class="panel-title">
                Messages
            </div>
            <div class="panel-footer" style="min-height:400px;">
                <div id="divmsg">
                </div>
            </div>
        </div>
    </div>
</div>



    @section Scripts{

        <script type="text/javascript">

        $(document).ready(function () {
            $("#btnsend").click(function () {
                send();
            });
            setInterval(function () {
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    data: '{}',
                    url: "@Url.Action("receive")",
                    dataType: "json",
                    success: function (response) {
                        var data = $("#divmsg").html();
                        $("#divmsg").html(data + "<br>" + response);

                    },
                    error: function (response) {

                    }
                });
            }, 5000);
            function send() {
                var message = $("#txtmsg").val();
                var recipient = $("#recipient").val();
                var data = $("#divmsg").html();
                $("#divmsg").html(data + "<br>Me:" + message);
                $("#txtmsg").val("");
                debugger;
                $.ajax({
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    data: '{"message":"' + message + '","recipient":"'+recipient+'"}',
                    url: "@Url.Action("sendmsg")",
                    dataType: "json",
                    success: function (response) {
                        var data = $("#divmsg").html();
                        $("#divmsg").html(data + "<br>Me :" + message);
                    },
                    error: function (response) {

                    }
                });
            }
        });
        </script>


    }
